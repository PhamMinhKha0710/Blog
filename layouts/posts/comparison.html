{{- define "title" }}{{ .Title }} - {{ .Site.Title }}{{ end -}}

{{- define "content" -}}
    {{- $params := .Scratch.Get "params" -}}
    
    <article class="post-single comparison-post">
        <header class="post-header">
            {{- /* Title */ -}}
            <h1 class="post-title">
                {{ .Title }}
            </h1>

            {{- /* Meta */ -}}
            <div class="post-meta">
                {{- /* Date */ -}}
                <time class="post-date" datetime="{{ .Date.Format "2006-01-02T15:04:05-07:00" }}">
                    {{- printf `<i class="far fa-calendar-alt fa-fw"></i> %s` (.Date.Format ($.Site.Params.dateFormat | default "2006-01-02")) | safeHTML -}}
                </time>
                
                {{- /* Categories */ -}}
                {{- with .Params.categories -}}
                <span class="post-categories">
                    <i class="far fa-folder fa-fw"></i>
                    {{- range $index, $value := . -}}
                        {{- if gt $index 0 }}, {{ end -}}
                        <a href="{{ print "/categories/" (urlize $value) | relLangURL }}">{{ $value }}</a>
                    {{- end -}}
                </span>
                {{- end -}}

                {{- /* Reading Time */ -}}
                <span class="post-reading-time">
                    <i class="far fa-clock fa-fw"></i>
                    {{- .ReadingTime }} phút đọc
                </span>

                {{- /* Author */ -}}
                {{- with .Params.author -}}
                <span class="post-author">
                    <i class="fas fa-user fa-fw"></i>
                    {{- . -}}
                </span>
                {{- end -}}
            </div>
        </header>

        {{- /* Featured Image */ -}}
        {{- $image := .Resources.GetMatch "featured-image" -}}
        {{- with .Params.featuredImage -}}
            {{- $image = . | relURL -}}
        {{- end -}}
        {{- with $image -}}
        <div class="post-featured-image">
            <img loading="lazy" src="{{ . }}" alt="Featured Image">
        </div>
        {{- end -}}

        {{- /* Comparison Summary */ -}}
        {{- with .Params.comparisonItems -}}
        <div class="comparison-summary">
            <h2>So sánh nhanh</h2>
            
            <div class="comparison-table-container">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Tiêu chí</th>
                            {{- range . -}}
                            <th>{{ .name }}</th>
                            {{- end -}}
                        </tr>
                    </thead>
                    <tbody>
                        {{- range $criteria, $label := $.Params.comparisonCriteria -}}
                        <tr>
                            <td class="criteria-name">{{ $label }}</td>
                            {{- range $.Params.comparisonItems -}}
                            <td class="criteria-value">
                                {{- with (index .criteria $criteria) -}}
                                    {{- . -}}
                                {{- else -}}
                                    -
                                {{- end -}}
                            </td>
                            {{- end -}}
                        </tr>
                        {{- end -}}
                        
                        {{- if $.Params.showRatings -}}
                        <tr class="comparison-rating-row">
                            <td class="criteria-name">Đánh giá</td>
                            {{- range $.Params.comparisonItems -}}
                            <td class="criteria-rating">
                                {{- with .rating -}}
                                    {{- $fullStars := math.Floor . -}}
                                    {{- $halfStar := eq (math.Mod . 1) 0.5 -}}
                                    
                                    {{- range $i, $_ := seq $fullStars -}}
                                        <i class="fas fa-star"></i>
                                    {{- end -}}
                                    
                                    {{- if $halfStar -}}
                                        <i class="fas fa-star-half-alt"></i>
                                    {{- end -}}
                                    
                                    {{- $emptyStars := sub 5 (add $fullStars (cond $halfStar 0.5 0)) -}}
                                    {{- range $i, $_ := seq (math.Floor $emptyStars) -}}
                                        <i class="far fa-star"></i>
                                    {{- end -}}
                                    
                                    <span class="rating-value">({{ . }})</span>
                                {{- else -}}
                                    -
                                {{- end -}}
                            </td>
                            {{- end -}}
                        </tr>
                        {{- end -}}
                    </tbody>
                </table>
            </div>
        </div>
        {{- end -}}

        {{- /* TOC */ -}}
        {{- if .Params.toc | default $params.toc | default $.Site.Params.page.toc | default true -}}
            {{- partial "single/toc.html" . -}}
        {{- end -}}

        {{- /* Content */ -}}
        <div class="post-content">
            {{- /* Display content */ -}}
            {{ .Content }}
        </div>
        
        {{- /* Comparison Conclusion */ -}}
        {{- with .Params.conclusion -}}
        <div class="comparison-conclusion">
            <h2><i class="fas fa-check-circle"></i> Kết luận</h2>
            <div class="conclusion-content">
                {{ . | markdownify }}
            </div>
        </div>
        {{- end -}}

        {{- /* Footer */ -}}
        <footer class="post-footer">
            {{- /* Tags */ -}}
            {{- with .Params.tags -}}
            <div class="post-tags">
                <i class="fas fa-tags fa-fw"></i>
                {{- range $index, $value := . -}}
                    {{- if gt $index 0 }}, {{ end -}}
                    <a href="{{ print "/tags/" (urlize $value) | relLangURL }}">{{ $value }}</a>
                {{- end -}}
            </div>
            {{- end -}}

            {{- /* Navigation between posts */ -}}
            {{- partial "single/post-navigation.html" . -}}
            
            {{- /* Share buttons */ -}}
            {{- partial "single/share.html" . -}}
        </footer>

        {{- /* Comment */ -}}
        {{- partial "comment.html" . -}}
    </article>
{{- end -}}





